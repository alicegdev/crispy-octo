# # Utilisez une image de base contenant Ruby et les outils nécessaires
# FROM ruby:3.1.3

# RUN apt-get update

# # Définit le répertoire de travail dans le conteneur
# WORKDIR /app

# # Add a new user "john" with user id 8877
# RUN useradd -u 8877 don
# # Change to non-root privilege
# USER don

# # Copie du Gemfile et du Gemfile.lock dans le conteneur
# COPY Gemfile Gemfile.lock ./

# # Installation des gems
# RUN bundle install

# RUN gem install sendgrid-ruby

# # Copie de tout le code source dans le conteneur
# COPY . .

# # Expose le port utilisé par votre application
# EXPOSE 3000

# # Commande par défaut pour démarrer votre application
# CMD ["rails", "server", "-b", "0.0.0.0"]


FROM ruby:3.1.3-alpine3.17

# common deps
RUN apk add --update \
    build-base \
    git \
    tzdata

# Application deps
RUN apk add --update \
    nodejs \
    mysql-client \
    mysql-dev \
    yarn


# install Bundler
RUN gem install bundler
# install rails
RUN gem install rails

WORKDIR /crispy-octo

COPY . /crispy-octo
# Copie du Gemfile et du Gemfile.lock dans le conteneur
COPY Gemfile Gemfile.lock ./

RUN bundle install

RUN gem install sendgrid-ruby

RUN cp .env.dist .env

EXPOSE 3000
CMD ["rails", "s", "-b", "0.0.0.0"]